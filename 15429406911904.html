<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  基础实践系列之编译成iOS可用的.a静态库 - 北哥传奇
  
  </title>
 <meta name="description" content="">
 <link href="atom.xml" rel="alternate" title="北哥传奇" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />

    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
    <script src="asset/highlightjs/highlight.pack.js"></script>
    <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
    <script>hljs.initHighlightingOnLoad();</script>
    
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>

<div id="header">
    <h1><a href="index.html">北哥传奇</a></h1>
</div>

</nav>
        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; 北哥传奇</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
      <li><a href="index.html">Home</a></li>
      
        <li class="divider"></li>
        <li><label>音视频技术</label></li>

          
            <li><a title="基础实践系列之实现解码功能" href="15429468991101.html">基础实践系列之实现解码功能</a></li>
          
            <li><a title="基础实践系列之编译成iOS可用的.a静态库" href="15429406911904.html">基础实践系列之编译成iOS可用的.a静态库</a></li>
          
            <li><a title="FFMPEG视音频基础探索-API(系列二)" href="15427852627727.html">FFMPEG视音频基础探索-API(系列二)</a></li>
          
            <li><a title="FFMPEG视音频基础探索-命令行(系列一)" href="15427812231625.html">FFMPEG视音频基础探索-命令行(系列一)</a></li>
          
            <li><a title="UDP-RTP协议解析（基础系列六）" href="15427692957422.html">UDP-RTP协议解析（基础系列六）</a></li>
          
            <li><a title="FLV封装格式解析（基础系列五）" href="15427076070232.html">FLV封装格式解析（基础系列五）</a></li>
          
            <li><a title="AAC音频码流解析（基础系列四）" href="15427004394453.html">AAC音频码流解析（基础系列四）</a></li>
          
            <li><a title="H.264视频码流解析（基础系列三）" href="15426950827326.html">H.264视频码流解析（基础系列三）</a></li>
          
            <li><a title="音频采样数据处理（基础系列二）" href="15426806992852.html">音频采样数据处理（基础系列二）</a></li>
          
            <li><a title="视频像素数据处理(基础系列一)" href="15426223369165.html">视频像素数据处理(基础系列一)</a></li>
          
            <li><a title="[TOC]" href="15420339112607.html">[TOC]</a></li>
          

      
        <li class="divider"></li>
        <li><label>MWeb</label></li>

          
            <li><a title="Markdown 语法和 MWeb 写作使用说明" href="15346594344474.html">Markdown 语法和 MWeb 写作使用说明</a></li>
          
            <li><a title="欢迎使用 MWeb" href="15346594344475.html">欢迎使用 MWeb</a></li>
          

      
        <li class="divider"></li>
        <li><label>金融</label></li>

          

      
      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>

        <section id="main-content" role="main" class="scroll-container">

          <div class="row">
            <div class="large-3 medium-3 columns">
              <div class="hide-for-small">
                <div class="sidebar">
                <nav>
                  <ul id="side-nav" class="side-nav">

                    
                      <li class="side-title"><span>音视频技术</span></li>
                        
                          <li><a title="基础实践系列之实现解码功能" href="15429468991101.html">基础实践系列之实现解码功能</a></li>
                        
                          <li><a title="基础实践系列之编译成iOS可用的.a静态库" href="15429406911904.html">基础实践系列之编译成iOS可用的.a静态库</a></li>
                        
                          <li><a title="FFMPEG视音频基础探索-API(系列二)" href="15427852627727.html">FFMPEG视音频基础探索-API(系列二)</a></li>
                        
                          <li><a title="FFMPEG视音频基础探索-命令行(系列一)" href="15427812231625.html">FFMPEG视音频基础探索-命令行(系列一)</a></li>
                        
                          <li><a title="UDP-RTP协议解析（基础系列六）" href="15427692957422.html">UDP-RTP协议解析（基础系列六）</a></li>
                        
                          <li><a title="FLV封装格式解析（基础系列五）" href="15427076070232.html">FLV封装格式解析（基础系列五）</a></li>
                        
                          <li><a title="AAC音频码流解析（基础系列四）" href="15427004394453.html">AAC音频码流解析（基础系列四）</a></li>
                        
                          <li><a title="H.264视频码流解析（基础系列三）" href="15426950827326.html">H.264视频码流解析（基础系列三）</a></li>
                        
                          <li><a title="音频采样数据处理（基础系列二）" href="15426806992852.html">音频采样数据处理（基础系列二）</a></li>
                        
                          <li><a title="视频像素数据处理(基础系列一)" href="15426223369165.html">视频像素数据处理(基础系列一)</a></li>
                        
                          <li><a title="[TOC]" href="15420339112607.html">[TOC]</a></li>
                        

                    
                      <li class="side-title"><span>MWeb</span></li>
                        
                          <li><a title="Markdown 语法和 MWeb 写作使用说明" href="15346594344474.html">Markdown 语法和 MWeb 写作使用说明</a></li>
                        
                          <li><a title="欢迎使用 MWeb" href="15346594344475.html">欢迎使用 MWeb</a></li>
                        

                    
                      <li class="side-title"><span>金融</span></li>
                        

                    
                  </ul>
                </nav>
                </div>
              </div>
            </div>
            <div class="large-9 medium-9 columns">

 <div class="markdown-body">
<h1>基础实践系列之编译成iOS可用的.a静态库</h1>

<p>比较完整的iOS编译脚本，可以一条命令执行<br/>
<a href="https://github.com/kewlbear/FFmpeg-iOS-build-script">https://github.com/kewlbear/FFmpeg-iOS-build-script</a> </p>

<p>下面来分解这条脚本的执行过程</p>

<ol>
<li><p>下载FFmpeg<br/>
<a href="http://ffmpeg.org/download.html">http://ffmpeg.org/download.html</a></p></li>
<li><p>编写编译脚本<br/>
主要是设置编译的参数，如下面的ffmpeg-build.sh。这个文件主要是配置编译到iOS设备的一些参数</p></li>
<li><p>下载gas-preprocessor.pl<br/>
编译库需要的支持，将其拷贝到/usr/local/bin目录下<br/>
<a href="https://github.com/mansr/gas-preprocessor">https://github.com/mansr/gas-preprocessor</a>  下载 perl 支持库</p></li>
<li><p>执行编译脚本<br/>
下载FFmpeg后的目录名是ffmpeg。在脚本文件里指定下载的文件目录名。./ffmpeg-build.sh执行完后就会在my-ffmpeg-iOS目录下生成相应的架构的.a库</p></li>
</ol>

<p>ffmpeg-build.sh   文件内容如下<br/>
（这个文件直接可以拿过去使用）</p>

<pre><code>#!/bin/bash

#1、首先：定义下载的库名称
source=&quot;ffmpeg&quot;

#2、其次：定义&quot;.h/.m/.c&quot;文件编译的结果目录
#目录作用：用于保存.h/.m/.c文件编译后的结果.o文件
cache=&quot;cache&quot;

#3、定义&quot;.a&quot;静态库保存目录
#pwd命令：表示获取当前目录
staticdir=`pwd`/&quot;my-ffmpeg-iOS&quot;

#4、添加FFmpeg配置选项-&gt;默认配置
#Toolchain options:工具链选项（指定我么需要编译平台CPU架构类型，例如：arm64、x86等等…）
#--enable-cross-compile: 交叉编译
#Developer options:开发者选项
#--disable-debug: 禁止使用调试模式
#Program options选项
#--disable-programs:禁用程序(不允许建立命令行程序)
#Documentation options：文档选项
#--disable-doc：不需要编译文档
#Toolchain options：工具链选项
#--enable-pic：允许建立与位置无关代码
configure_flags=&quot;--enable-cross-compile --disable-debug --disable-programs --disable-doc --enable-pic&quot;

#5、定义默认CPU平台架构类型
#arm64 armv7-&gt;真机-&gt;CPU架构类型
#x86_64 i386-&gt;模拟器-&gt;CPU架构类型
archs=&quot;arm64 armv7 x86_64 i386&quot;

#6、指定我们的这个库编译系统版本-&gt;iOS系统下的7.0以及以上版本使用这个静态库
targetversion=&quot;8.0&quot;

#7、接受命令后输入参数
#我是动态接受命令行输入CPU平台架构类型(输入参数：编译指定的CPU库)
if [ &quot;$*&quot; ]
then
    #存在输入参数，也就说：外部指定需要编译CPU架构类型
    archs=&quot;$*&quot;
fi

#8、安装汇编器-&gt;yasm
#判断一下是否存在这个汇编器
#目的：通过软件管理器(Homebrew)，然后下载安装（或者更新）我的汇编器
#一个命令就能够帮助我们完成所有的操作
#错误一：`which` yasm
#正确一：`which yasm`
if [ ! `which yasm`  ]
then
    #Homebrew:软件管理器
    #下载一个软件管理器:安装、卸载、更新、搜索等等...
    #错误二：`which` brew
    #正确二：`which brew`
    if [ ! `which brew` ]
    then
        echo &quot;安装brew&quot;
        ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot; || exit 1
    fi
    echo &quot;安装yasm&quot;
    #成功了
    #下载安装这个汇编器
    #exit 1-&gt;安装失败了，那么退出程序
    brew install yasm || exit 1
fi

echo &quot;循环编译&quot;

#9、for循环编译FFmpeg静态库
currentdir=`pwd`
echo &quot;当前执行编译路径&quot; ${currentdir};
for arch in $archs
do
    echo &quot;开始编译&quot;
    #9.1、创建目录
    #在编译结果目录下-创建对应的平台架构类型
    mkdir -p &quot;$cache/$arch&quot;
    #9.2、进入这个目录
    cd &quot;$cache/$arch&quot;

    #9.3、配置编译CPU架构类型-&gt;指定当前编译CPU架构类型
    #错误三：&quot;--arch $arch&quot;
    #正确三：&quot;-arch $arch&quot;
    archflags=&quot;-arch $arch&quot;

    #9.4、判定一下你到底是编译的是模拟器.a静态库，还是真机.a静态库
    if [ &quot;$arch&quot; = &quot;i386&quot; -o &quot;$arch&quot; = &quot;x86_64&quot; ]
    then
        #模拟器
        platform=&quot;iPhoneSimulator&quot;
        #支持最小系统版本-&gt;iOS系统
        archflags=&quot;$archflags -mios-simulator-version-min=$targetversion&quot;
    else
        #真机(mac、iOS都支持)
        platform=&quot;iPhoneOS&quot;
        #支持最小系统版本-&gt;iOS系统
        archflags=&quot;$archflags -mios-version-min=$targetversion -fembed-bitcode&quot;
        #注意:优化处理(可有可无)
        #如果架构类型是&quot;arm64&quot;，那么
        if [ &quot;$arch&quot; = &quot;arm64&quot; ]
        then
            #GNU汇编器（GNU Assembler），简称为GAS
            #GASPP-&gt;汇编器预处理程序
            #解决问题：分段错误
            #通俗一点：就是程序运行时,变量访问越界一类的问题
            EXPORT=&quot;GASPP_FIX_XCODE5=1&quot;
        fi
    fi


    #10、正式编译
    #tr命令可以对来自标准输入的字符进行替换、压缩和删除
    #&#39;[:upper:]&#39;-&gt;将小写转成大写
    #&#39;[:lower:]&#39;-&gt;将大写转成小写
    #将platform-&gt;转成大写或者小写
    XCRUN_SDK=`echo $platform | tr &#39;[:upper:]&#39; &#39;[:lower:]&#39;`
    #编译器-&gt;编译平台
    CC=&quot;xcrun -sdk $XCRUN_SDK clang&quot;

    #架构类型-&gt;arm64
    if [ &quot;$arch&quot; = &quot;arm64&quot; ]
    then
        #音视频默认一个编译命令
        #preprocessor.pl帮助我们编译FFmpeg-&gt;arm64位静态库
        AS=&quot;gas-preprocessor.pl -arch aarch64 -- $CC&quot;
    else
        #默认编译平台
        AS=&quot;$CC&quot;
    fi

    echo &quot;执行到了1&quot;

    #目录找到FFmepg编译源代码目录-&gt;设置编译配置-&gt;编译FFmpeg源码
    #--target-os:目标系统-&gt;darwin(mac系统早起版本名字)
    #darwin:是mac系统、iOS系统祖宗
    #--arch:CPU平台架构类型
    #--cc：指定编译器类型选项
    #--as:汇编程序
    #$configure_flags最初配置
    #--extra-cflags
    #--prefix：静态库输出目录
    TMPDIR=${TMPDIR/%\/} $currentdir/$source/configure \
        --target-os=darwin \
        --arch=$arch \
        --cc=&quot;$CC&quot; \
        --as=&quot;$AS&quot; \
        $configure_flags \
        --extra-cflags=&quot;$archflags&quot; \
        --extra-ldflags=&quot;$archflags&quot; \
        --prefix=&quot;$staticdir/$arch&quot; \
        || exit 1

    echo &quot;执行了&quot;

    #解决问题-&gt;分段错误问题
    #安装-&gt;导出静态库(编译.a静态库)
    #执行命令
    make -j3 install $EXPORT || exit 1
    #回到了我们的脚本文件目录
    cd $currentdir
done

</code></pre>


</div>

<br /><br />
<hr />

<div class="row clearfix">
  <div class="large-6 columns">
	<div class="text-left" style="padding:15px 0px;">
		
	        <a href="15429468991101.html"  title="Previous Post: 基础实践系列之实现解码功能">&laquo; 基础实践系列之实现解码功能</a>
	    
	</div>
  </div>
  <div class="large-6 columns">
	<div class="text-right" style="padding:15px 0px;">
		
	        <a href="15427852627727.html" 
	        title="Next Post: FFMPEG视音频基础探索-API(系列二)">FFMPEG视音频基础探索-API(系列二) &raquo;</a>
	    
	</div>
  </div>
</div>

<div class="row">
<div style="padding:0px 0.93em;" class="share-comments">

</div>
</div>
<script type="text/javascript">
	$(function(){
		var currentURL = '15429406911904.html';
		$('#side-nav a').each(function(){
			if($(this).attr('href') == currentURL){
				$(this).parent().addClass('active');
			}
		});
	});
</script>  
</div></div>


<div class="page-bottom">
  <div class="row">
  <hr />
  <div class="small-9 columns">
  <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
  <div class="small-3 columns">
  <p class="copyright text-right"><a href="#header">TOP</a></p>
  </div>
   
  </div>
</div>

        </section>
      </div>
    </div>
    
    
    <script src="asset/js/foundation.min.js"></script>
    <script src="asset/js/foundation/foundation.offcanvas.js"></script>
    <script>
      $(document).foundation();

     
    </script>
    


  </body>
</html>
